{% extends "base.html" %}
{% block content %}
     <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="sidebar-nav well">
            <ul class="nav nav-list">
              <li class="nav-header">Главное меню</li>
                <li><a href="/dashboard/"><i class="icon-home"></i>Центр управления</a></li>
                <li><a href="/overview/{{ host_id }}/"><i class="icon-info-sign"></i>Cервер <strong>{{ kvm_host.hostname }}</strong></a></li>
              <li class="nav-header"></i>Настройки сервера</li>
                <li><a href="/newvm/{{ host_id }}/"><i class="icon-plus"></i>Создать ВМ</a></li>
                <li><a href="/storage/{{ host_id }}/"><i class="icon-folder-open"></i>Хранилище</a></li>
                <li><a href="/network/{{ host_id }}/"><i class="icon-signal"></i>Виртуальные сети</a></li>
                <li><a href="/snapshot/{{ host_id }}/{{ vname }}/"><i class="icon-download-alt"></i>Снапшоты</a></li>
                <li><a href="/logs/{{ host_id }}/"><i class="icon-list-alt"></i>Логи</a></li>
              <li class="nav-header">Виртуальные машины</li>
                {% if not all_vm %}
                <li><a href="/newvm/{{ host_id }}/"><i class="icon-plus"></i>Создать ВМ</a></li>
                {% endif %}
                {% for name, state in all_vm.items %}
                {% if vname == name %} 
                <li class="active"><a href="/vm/{{ host_id }}/{{ name }}/"><i class="icon-th-large icon-white"></i>{{name}}</a></li>
                {% else %}
                <li><a href="/vm/{{ host_id }}/{{ name }}/"><font color="{% if state == 1 %}green{% endif %}{% if state == 5 %}red{% endif %}{% if state == 3 %}orange{% endif %}"><i class="icon-th-large"></i>{{ name }}</font></a></li>
                {% endif %}
                {% endfor %}
            </ul>
          </div>
        </div>
    <div class="span8">
      <div class="page-header">
          <h2>Управление виртуальной машиной</h2>
        </div>
          {% if message %}
            <div class="alert alert-info">
              <a class="close" data-dismiss="alert">&times;</a>
            {{ message }}
            </div>
          {% endif %}
          {% if errors %}
          {% for error in errors %}
            <div class="alert alert-error">
              <a class="close" data-dismiss="alert">&times;</a>
            {{ error }}
            </div>
          {% endfor %}
          {% endif %}
      <div class="row">
      	<div class="span8">
              <form action="/vm/{{ host_id }}/{{ vname }}/" method="post">
              {% if state = 5 %}
                <input class="btn btn-primary" type="submit" name="start" value="Запуск">
              {% endif %}
              {% if state = 3 %}
                <input class="btn btn-primary" type="submit" name="resume" value="Возобновить">
              {% endif %}
              {% if state = 1 %}
                <input class="btn btn-primary" type="submit" name="suspend" value="Приостановить" onclick="return confirm('Вы уверены?')">
                <input class="btn btn-primary" type="submit" name="reboot" value="Перезагрузить" onclick="return confirm('Вы уверены?')">
                <input class="btn btn-primary" type="submit" name="shutdown" value="Выключить" onclick="return confirm('Вы уверены?')">
                <input class="btn btn-primary" type="submit" name="destroy" value="Выкл. принудительно" onclick="return confirm('Вы уверены?')">
                <input class="btn btn-primary" type="button" value="VNC: {{ vnc_port }}" onclick="window.open('/vnc/{{ host_id }}/{{ vname }}/', '_blank','width=830,height=648,status=no,location=no,toolbar=no,menubar=no')">
              {% endif %}
              </form>
              </div>
                <div class="span2">
                  <p>Название</p>
                  <p>Архитектура</p>
                  <p>Статус</p>
                  <p>Сеть</p>
                  <p>Ядра</p>
                  <p>Загрузка ЦПУ</p>
                  <p>Память</p>
                  <p style="height:22px">Используется</p>
                  <p style="height:34px">Автозапуск</p>
                  <p>Образ HDD</p>
                  <p>Образ CD</p>
                </div>
                <div class="span4">
                  <p><strong>{{ vname }}</strong></p>
                  <p>{{ vm_arch }}</p>
                  <p>{% if active == 1 %}<font color="green">активно</font>{% else %}<font color="red">не активно</font>{% endif %}</p>
                  <p>{{ vm_nic.0 }} ({{ vm_nic.1 }})</p>
                  <p>выделено {{ core }} из {{ all_core }}</p>
                    <div class="progress progress-danger progress-striped active" style="margin-bottom: 9px; width:220px;">
                      <div class="bar" style="width: {{ cpu_usage }}%;"><font color="black">{{ cpu_usage }}%</font></div>
                    </div>
                  <p>выделено {{ memory|filesizeformat }} из {{ mem_usage.0|filesizeformat }}</p>
                    <div class="progress progress-warning progress-striped active" style="margin-bottom: 9px; width:220px;">
                        <div class="bar" style="width: {% if state == 1 %} {{ mem_usage.1 }}%; {% else %} 0%; {% endif %}"><font color="black">{% if state == 1 %} {{ mem_usage.1 }}% {% else %} 0% {% endif %}</font></div> 
                    </div>
                    <form action="/vm/{{ host_id }}/{{ vname }}/" method="post">
                      {% if autostart == 1 %}
                        <input class="btn btn-primary" type="submit" name="auto_off" value="Выключить" onclick="return confirm('Вы уверены?')">
                      {% else %}
                        <input class="btn btn-primary" type="submit" name="auto_on" value="Включить" onclick="return confirm('Вы уверены?')"> 
                      {% endif %}
                    </form>
                  <p>{{ hdd.0 }} | {{ hdd.1|filesizeformat }}</p>
                  <p>{% if cdrom == None %} {% else %} {{ cdrom.0 }} | {{ cdrom.2|filesizeformat }} {% endif %}</p>
                    <form action="/vm/{{ host_id }}/{{ vname }}/" method="post">
                      {% if cdrom %}
                      <input class="btn btn-primary" type="submit" name="disconnect" value="Отключить" onclick="return confirm('Вы уверены?')">
                      {% else %}
                      <select name="iso_img">
                      {% for iso in isos %}
                          <option value="{{ iso }}">{{ iso }}</option>
                      {% endfor %} 
                      </select><br>
                      <input class="btn btn-primary" type="submit" name="connect" value="Подключить"> 
                      {% endif %}
                    </form>
                  </p>
                </div>
              </div>
              <form action="/vm/{{ host_id }}/{{ vname }}/" method="post">
                {% if state != 3 %}
                <input class="btn btn-primary" type="submit" name="snapshot" value="Создать снапшот">
                {% endif %}
                {% if num_snapshot > 0 or state = 1 %}
                <input class="btn btn-primary disabled" type="button" value="Удалить">
                {% else %}
                <input class="btn btn-primary" type="submit" name="undefine" value="Удалить" onclick="return confirm('Вы уверены?')">
                {% endif %}
              </form>
            {% if num_snapshot > 0 %}
            <p><strong>Для того чтобы <a href="/snapshot/{{ host_id }}/{{ vname }}/">удалить</a> виртуальную машину, удалите ее снапшоты</strong></p>
            {% endif %}
            </div>
          </div>
{% endblock %}